<?xml version="1.0" encoding="UTF-8"?>
<odoo>
  <data>

    <!-- Coordinator Form View -->
    <record id="view_repair_order_form_coordinator" model="ir.ui.view">
      <field name="name">repair.order.form.coordinator</field>
      <field name="model">repair.order</field>
      <field name="inherit_id" ref="repair.view_repair_order_form"/>
      <field name="arch" type="xml">
      
              <!-- Add custom header with state buttons -->
        <xpath expr="//header" position="replace">
            <header>
                <!-- Confirm -->
                <!-- <button name="action_confirm"
                        type="object"
                        string="Confirm Repair"
                        invisible="state != 'draft'"
                        class="oe_highlight"/> -->

                <!-- Start Repair -->
                <button name="action_start_repair"
                        type="object"
                        string="Start Repair"
                        invisible="state != 'draft'"
                        confirm="Are you sure you want to start the repair? Have you got permission from the customer?"/>



                <!-- End Repair -->
                <button name="action_end_repair"
                        type="object"
                        string="Mark as Done"
                        invisible="state != 'under_repair'"
                        confirm="Are you sure the repair is complete?"/>

                <!-- Cancel -->
                <button name="action_cancel"
                        type="object"
                        string="Cancel"
                        invisible="state == 'done' or state == 'cancel'"
                        confirm="Are you sure you want to cancel this repair?"/>


                <!-- Reset to Draft -->
                <button name="action_reset_to_draft"
                        type="object"
                        string="Reset to Draft"
                        invisible="state != 'cancel' and state != 'done'"/>

                <field name="state" widget="statusbar" statusbar_visible="draft,under_repair,done"/>
            </header>

        </xpath>

        <!-- Replace top section with coordinator-friendly layout -->
        <xpath expr="//form/sheet/group[1]" position="replace">
          
            <group class="oxord-card" colspan="2">

                <!-- Customer Information -->
                <group string = "Customer Info">
                  <field name="partner_id" string="Customer"/>
                  <field name="customer_type"/>
                  <field name="company_category"
                        invisible = "customer_type == 'individual'"
                        required = "customer_type ==  'company'"/>
                  <field name="phone" string="Telephone"/>
                  <field name="email" string="Email"/>
                  <field name="facebook"/>
                </group>

                <!-- OXORD Info -->
                <group string = "OXORD Info">
                  <field name="branch"/>
                  <field name="company_id"/>
                </group>


            </group>
          
        </xpath>

        <!-- Process Timeline / Sections -->
        <xpath expr="//form/sheet/notebook" position="before">
            <!-- Department Selection Card -->
            <group class="oxord-card" string="Department" col="2">
                <!-- Department as radio selection -->
                <field name="department_id" widget="radio" options="{'horizontal': true}"/>

                <!-- Unit Type shown as radio, filtered dynamically -->
                <field name="unit_type_id"
                      widget="radio"
                      options="{'horizontal': true, 'no_create': True}"
                      domain="[('department_id', '=', department_id)]"/>
            </group>




            <!-- Unit Information Card -->
            <group class="oxord-card" string="Unit Information" col="2"
                  invisible="not show_unit_info">
                <!-- Left column -->
                <group>
                    <field name="brand_id" options="{'no_create': True}" domain="[('unit_type_id', '=', unit_type_id)]"/>
                    <field name="model_id"
                          string="Model"
                          options="{'no_create': True}"
                          domain="[('brand_id', '=', brand_id)]"/>
                    <field name="serial" string="Serial"/>
                    <field name="accessories" string="Accessories"/>
                </group>
                <!-- Right column -->
                <group>
                    <field name="pop_date" string="POP Date"/>
                    <field name="warranty" string="Warranty"/>
                    <field name="password" string="Password"/>
                    <field name="ok_to_format" string="Ok to Format"/>
                    <field name="problem" string="Problem"/>
                </group>
            </group>


            <group class="oxord-card" string="Receiving Details" col="2">
              <field name="received_date" string="Date and Time"/>
              <field name="received_by" string="Received By"/>
              <field name="remarks" string="Remarks"/>
            </group>

            <group class = "oxord-card" string="Service Details" col="2">
                <!-- Left column -->
                <group>
                    <field name="endorse_to_tech" string="Technician/Engr. Assigned"/>
                    <field name="action_taken" string="Action Taken"/>
                </group>

                <!-- Right column -->
                <group>
                    <field name="labor_amount" string="Labor Amount"/>
                    <field name="total_charge" string="Total Charge"/>
                    <field name="technician_remarks" string="Technician Remarks"/>
                </group>
            </group>
        </xpath>

      </field>
    </record>

  </data>
</odoo>
