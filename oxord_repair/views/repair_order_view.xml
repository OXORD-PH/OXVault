<?xml version="1.0" encoding="UTF-8"?>
<odoo>
  <data>

    <!-- Coordinator Form View -->
    <record id="view_repair_order_form_coordinator" model="ir.ui.view">
      <field name="name">repair.order.form.coordinator</field>
      <field name="model">repair.order</field>
      <field name="inherit_id" ref="repair.view_repair_order_form"/>
      <field name="arch" type="xml">
          


        <!-- Add custom header with state buttons -->
        <xpath expr="//form/header" position="replace">
            <header>
                <!-- Hidden state field -->
                <field name="state" invisible="1"/>

                <!-- Start Repair -->
                <button name="action_start_repair"
                        type="object"
                        string="Start Repair"
                        invisible="state not in ('draft','new')"
                        groups="oxord_repair.group_technical_head,base.group_system"
                        confirm="Are you sure you want to start the repair? Have you got permission from the customer?"/>

                <!-- End Repair (trigger wizard) -->
                <button name="action_open_endorse_wizard"
                        type="object"
                        string="Mark as Done"
                        invisible="state != 'under_repair'"
                        groups="oxord_repair.group_technical_head,oxord_repair.group_repair_coordinator,base.group_system"/>

                <!-- Release -->
                <button name="action_release"
                        type="object"
                        string="Release"
                        invisible="state != 'done'"
                        groups="oxord_repair.group_repair_coordinator,base.group_system"/>

                <button name="action_create_payment_invoice"
                        string="Payment"
                        type="object"
                        class="btn-primary"
                        invisible="state not in ('done') or invoice_count &gt; 0"
                        groups="oxord_repair.group_repair_coordinator,base.group_system"/>

                <!-- Cancel -->
                <button name="action_cancel"
                        type="object"
                        string="Cancel"
                        invisible="state in ('done','cancel')"
                        groups="base.group_system"
                        confirm="Are you sure you want to cancel this repair?"/>

                <!-- Reset to Draft -->
                <button name="action_reset_to_draft"
                        type="object"
                        string="Reset to Draft"
                        invisible="state not in ('cancel','done')"
                        groups="base.group_system"/>

                <!-- Print button: last in line -->
                <button name="action_print_claim_form"
                        type="object"
                        string="Print"
                        class="oe_highlight #{print_button_class}"
                        groups="oxord_repair.group_repair_coordinator,base.group_system"/>

                <!-- Re-Repair button -->
                <button name="action_rereturn"
                        type="object"
                        string="Re-Repair"
                        icon="fa-repeat"
                        invisible="state != 'released'"
                        groups="oxord_repair.group_repair_coordinator,base.group_system"/>
                
                <button name="%(oxord_repair.action_technical_report_form)d"
                        string="Create Technical Report"
                        type="action"
                        class="oe_highlight"
                        context="{'default_repair_order_id': id}"
                        groups="oxord_repair.group_technical_head,base.group_system"/>



                <!-- Statusbar -->
                <field name="state" widget="statusbar" statusbar_visible="draft,under_repair,done,payment,released"/>
            </header>
        </xpath>


        <!-- Replace top section with coordinator-friendly layout -->
        <xpath expr="//form/sheet/group[1]" position="replace">

            <field name="customer_category" widget="radio" options="{'horizontal': true}" readonly="readonly_customer_info"/>
          
            <group class="oxord-card" colspan="2">

                <!-- Customer Information -->
                <group string = "Customer Info">
                  <field name="partner_id" string="Customer" readonly="readonly_customer_info"/>
                  <field name="contact_person_id" 
                        options="{'no_create': True}"
                        invisible="not show_contact_person"
                        readonly="readonly_customer_info"/>
                  <field name="company_category"
                        string="Company Type"
                        invisible="not show_company_type"
                        readonly="readonly_customer_info"/>
                  <field name="individual_type"
                        string="Individual Type"
                        invisible="not show_individual_type"
                        readonly="readonly_customer_info"/>
                </group>

                <!-- OXORD Info -->
                <group string="OXORD Info">
                    <field name="service_type" widget="radio" options="{'horizontal': true}" readonly="readonly_customer_info"/>
                    <field name="company_id" readonly="readonly_customer_info"/>
                </group>


            </group>
          
        </xpath>

        <xpath expr="//form/sheet/notebook" position="before">
            <group class="oxord-card" col="2">
                <!-- Left column: Department Info -->
                <group string="Department Info">
                    <field name="department_id" widget="radio" options="{'horizontal': true}" readonly="readonly_customer_info"/>
                    <field name="unit_type_id"
                           widget="radio"
                           options="{'horizontal': true, 'no_create': True}"
                           domain="[('department_id', '=', department_id)]"
                           readonly="readonly_customer_info"/>
                </group>
        
                <!-- Right column: Repair Info -->
                <group string="Repair Info" invisible="not show_repair_info">
                    <field name="is_rerepair" readonly="1"/>
                    <field name="original_repair_id" readonly="1" options="{'no_create': True}"/>
                </group>
            </group>





            <!-- Unit Information Card -->
            <group class="oxord-card" string="Unit Information" col="2"
                  invisible="not show_unit_info">
                <!-- Left column -->
                <group>
                    <field name="brand_id" options="{'no_create': True}"
                           readonly="readonly_customer_info"/>
                    <field name="model_id"
                          string="Model"
                          options="{'no_create': True}"
                          readonly="readonly_customer_info"/>
                    <field name="serial" string="Serial"  readonly="readonly_customer_info"/>
                    <field name="accessory_ids" widget="many2many_tags"/>
                    <field name="password" string="Password"/>

                </group>
                <!-- Right column -->
                <group>
                    <field name="pop_date" string="POP Date"/>
                    <field name="warranty_expiry_date" string="Warranty Expiry Date" readonly="1"/>
                    <field name="warranty_status" widget="badge" string="Warranty Status" readonly="1"/>   
                    <field name="problem_ids" widget="many2many_tags" options="{'no_create': True}"/>
                    <field name="estimated_cost" string="Total Cost" readonly="1"/>
                </group>
            </group>

            <!-- Side-by-side Receiving and Releasing Details -->
            <group class="oxord-card" colspan="2">

                <!-- Left column: Receiving Details -->
                <group string="Receiving Details">
                    <field name="received_date" string="Date and Time" readonly="readonly_customer_info"/>
                    <field name="received_by" string="Received By" required="1" readonly="readonly_customer_info"/>
                    <field name="remarks" string="Remarks"/>
                </group>

                <!-- Right column: Releasing Details -->
                <group string="Releasing Details" invisible="not show_releasing">
                    <field name="coordinator_id" readonly="1"/>
                </group>

            </group>

            <group class = "oxord-card" string="Service Details" col="2">
                <!-- Left column -->
                <group>
                    <field name="endorse_to_tech" string="Technician/Engr. Assigned" required="1"/>
                    <field name="previous_technician_id" string="Previous Technician" readonly="1"/>
                    <field name="action_taken" string="Action Taken"/>
                </group>

                <!-- Right column -->
                <group>
                    <field name="labor_amount" string="Labor Amount"/>
                    <field name="technician_remarks" string="Technician Remarks"/>
                </group>
            </group>

            <group class="oxord-card" string="Aging Information" col="2"
                  groups="base.group_system">

              <!-- Left column: key dates -->
              <group>
                <field name="received_date" readonly="1"/>
                <field name="repair_start_date" readonly="1"/>
                <field name="repair_end_date" readonly="1"/>
                <field name="released_date" readonly="1"/>
              </group>

              <!-- Right column: formatted durations -->
              <group>
                <field name="total_aging_formatted" readonly="1"/>
                <field name="repair_duration_formatted" readonly="1"/>
                <field name="previous_tech_duration_formatted" string="First Technician Aging" readonly="1"/>
                <field name="current_tech_duration_formatted" string="Current Technician Aging" readonly="1"/>
                <field name="coordinator_to_release_formatted" readonly="1" string="Coordinator â†’ Release"/>

              </group>
            </group>
        </xpath>
          
      </field>
    </record>


  </data>
</odoo>
